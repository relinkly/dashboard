<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multiple Google Sheets Tables with Tabs</title>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px auto;
      max-width: 1200px;
      background: #f9f9f9;
      font-size: 11px;
      padding: 0 10px;
      box-sizing: border-box;
    }

    h1 {
      text-align: center;
      font-size: 16px;
      margin-top: 40px;
      margin-bottom: 10px;
      color: #333;
    }

    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 20px;
    }

    .tab-button {
      cursor: pointer;
      padding: 10px 20px;
      background: #eee;
      border: 1px solid #ccc;
      border-bottom: none;
      font-weight: bold;
      font-size: 14px;
      border-radius: 5px 5px 0 0;
      user-select: none;
      transition: background-color 0.3s;
    }

    .tab-button.active {
      background: white;
      border-bottom: 2px solid white;
      color: #333;
    }

    .tab-content {
      display: none;
      background: white;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 0 5px 5px 5px;
    }

    .tab-content.active {
      display: block;
    }

    table.dataTable {
      width: 100% !important;
      margin-bottom: 40px;
      font-size: 11px;
      box-sizing: border-box;
      overflow-x: auto;
      display: block;
    }

    table.dataTable th,
    table.dataTable td {
      font-size: 11px !important;
      white-space: nowrap;
    }

    #grid-filter-container {
      max-width: 1200px;
      margin: 0 auto 20px auto;
      text-align: center;
    }

    #grid-filter-container button {
      margin: 3px 5px;
      padding: 6px 12px;
      font-size: 11px;
      cursor: pointer;
      border: 1px solid #888;
      border-radius: 3px;
      background-color: #f0f0f0;
      transition: background-color 0.2s;
    }

    #grid-filter-container button:hover {
      background-color: #ddd;
    }

    #grid-filter-container button.active {
      background-color: #2196F3;
      color: white;
      border-color: #0b7dda;
    }

    #watermark {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      user-select: none;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0.1;
      color: #000000;
      font-size: 10vw;
      font-weight: 900;
      font-family: Arial, sans-serif;
      text-align: center;
      transform: translate(-50%, -50%);
      overflow: hidden;
    }

    #watermark > div {
      margin: 0.1em 0;
      width: 100%;
      white-space: normal;
    }
  </style>
</head>
<body>

<div id="watermark"></div>

<!-- Back button -->
<div style="margin-bottom: 20px;">
  <button onclick="window.location.href='menu.html'" style="padding: 6px 12px; font-size: 12px; cursor: pointer;">
    &larr; Back to Menu
  </button>
</div>

<!-- New main heading -->
<h1 style="text-align: center; font-size: 18px; margin-bottom: 30px; color: #333;">
  ZL & BVS Active Retail
</h1>
  
<div id="grid-filter-container">
  <button id="grid-filter-clear">Clear</button>
</div>

<div class="tabs">
  <div class="tab-button active" data-tab="etop">ZL</div>
  <div class="tab-button" data-tab="zl">BVS</div>
</div>

<div id="etop" class="tab-content active">
  <h1>Grid Level</h1>
  <table id="sheetTable3" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>

  <h1>Franchise Level</h1>
  <table id="sheetTable4" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>
</div>

<div id="zl" class="tab-content">
  <h1>Grid Level</h1>
  <table id="sheetTable7" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>

  <h1>Franchise Level</h1>
  <table id="sheetTable8" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<!-- PapaParse CSV parser -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
  let dataTables = {}; // Store DataTables instances and info
  let loadedCount = 0; // Track how many tables finished loading

  function applyGridFilter(value) {
    if (!dataTables || Object.keys(dataTables).length === 0) return;
    Object.values(dataTables).forEach(({ dt, gridColIndex }) => {
      if (gridColIndex === -1) return;
      dt.columns(gridColIndex).search(value, true, false, true).draw();
    });
  }

  const gridIds = [
    "Grid 101", "Grid 105", "Grid 106", "Grid 102", "Grid 104", "Grid 103",
    "Grid 401", "Grid 402", "Grid 403", "Grid 404", "Grid 405",
    "Grid 501", "Grid 502", "Grid 503", "Grid 504", "Grid 505", "Grid 506", "Grid 507", "Grid 508", "Grid 509",
    "Grid 601", "Grid 602", "Grid 603", "Grid 604", "Grid 605"
  ];

  const gridFilterContainer = document.getElementById('grid-filter-container');
  const clearBtn = document.getElementById('grid-filter-clear');
  const selectedGrids = new Set();

  gridIds.forEach(gridId => {
    const btn = document.createElement('button');
    btn.textContent = gridId;
    btn.addEventListener('click', () => {
      selectedGrids.has(gridId) ? selectedGrids.delete(gridId) : selectedGrids.add(gridId);
      updateFilter();
      updateButtonStyles();
    });
    gridFilterContainer.insertBefore(btn, clearBtn);
  });

  clearBtn.addEventListener('click', () => {
    selectedGrids.clear();
    updateFilter();
    updateButtonStyles();
  });

  function updateFilter() {
    const regex = Array.from(selectedGrids)
      .map(g => g.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'))
      .join('|');
    applyGridFilter(selectedGrids.size === 0 ? '' : regex);
  }

  function updateButtonStyles() {
    const buttons = gridFilterContainer.querySelectorAll('button');
    buttons.forEach(btn => {
      btn.classList.toggle('active', btn === clearBtn ? selectedGrids.size === 0 : selectedGrids.has(btn.textContent));
    });
  }

  // Tab switching
  document.querySelectorAll('.tab-button').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.tab-button').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.tab).classList.add('active');
    });
  });

  const sheets = [
  { url: "https://docs.google.com/spreadsheets/d/1GsuErz0oKGJSlk7aJ7hUUZi8dJ-tObZ1ll73AhqtNZY/export?format=csv&gid=0", tableId: "sheetTable3" },
  { url: "https://docs.google.com/spreadsheets/d/1GsuErz0oKGJSlk7aJ7hUUZi8dJ-tObZ1ll73AhqtNZY/export?format=csv&gid=1196662913", tableId: "sheetTable4" },
  { url: "https://docs.google.com/spreadsheets/d/1GsuErz0oKGJSlk7aJ7hUUZi8dJ-tObZ1ll73AhqtNZY/export?format=csv&gid=1028097947", tableId: "sheetTable7" },
  { url: "https://docs.google.com/spreadsheets/d/1GsuErz0oKGJSlk7aJ7hUUZi8dJ-tObZ1ll73AhqtNZY/export?format=csv&gid=1979603911", tableId: "sheetTable8" }
];


  sheets.forEach(({ url, tableId }) => {
    Papa.parse(url, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function (results) {
        const data = results.data;
        const table = document.getElementById(tableId);
        const thead = table.querySelector("thead");
        const tbody = table.querySelector("tbody");

        thead.innerHTML = "";
        tbody.innerHTML = "";

        const columns = Object.keys(data[0] || {});
        const trHead = document.createElement("tr");
        columns.forEach(col => {
          const th = document.createElement("th");
          th.textContent = col;
          trHead.appendChild(th);
        });
        thead.appendChild(trHead);

        data.forEach(row => {
          const tr = document.createElement("tr");
          columns.forEach(col => {
            const td = document.createElement("td");
            td.textContent = row[col];
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });

        const dt = $(table).DataTable({
          paging: true,
          searching: true,
          info: true,
          order: [],
          lengthMenu: [10, 25, 50, 100],
          pageLength: 25,
          autoWidth: false,
          language: {
            paginate: { previous: "<", next: ">" }
          }
        });

        const gridColIndex = columns.findIndex(c => c.trim().toLowerCase() === "grid");
        dataTables[tableId] = { dt, columns, gridColIndex };

        // Watermark for specific users
        const whitelist = ["sameenyaser", "naumanzaheer"];
        const currentUsername = localStorage.getItem("username");
        const watermarkDiv = document.getElementById('watermark');
        const repeatCount = 10;

        if (currentUsername && whitelist.includes(currentUsername)) {
  const repeatedText = currentUsername + " ";
  watermarkDiv.innerHTML = Array(repeatCount).fill(`<div>${repeatedText}</div>`).join('');
  watermarkDiv.style.display = 'flex';
} else {
  watermarkDiv.style.display = 'none';
}


        // Only apply filter after all tables are loaded
        loadedCount++;
        if (loadedCount === sheets.length) {
          updateButtonStyles();
          applyGridFilter('');
        }
      }
    });
  });
</script>

</body>
</html>
