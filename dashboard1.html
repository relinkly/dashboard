<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multiple Google Sheets Tables with Tabs</title>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />

  <style>
    body {
  font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  max-width: 1100px;
  margin: 30px auto;
  background: #fff;
  font-size: 15px;
  color: #333;
  padding: 0 20px;
  box-sizing: border-box;
  line-height: 1.6;
}

h1 {
  font-weight: 600;
  font-size: 22px;
  margin: 40px 0 20px;
  color: #222;
  border-bottom: 2px solid #0073e6;
  padding-bottom: 6px;
  max-width: 320px;
  margin-left: auto;
  margin-right: auto;
  letter-spacing: 0.02em;
}

.tabs {
  display: flex;
  justify-content: center;
  margin-bottom: 30px;
  gap: 16px;
  flex-wrap: wrap;
}

.tab-button {
  cursor: pointer;
  padding: 10px 24px;
  background: #f8f9fa;
  border: 1.5px solid #d1d5db;
  font-weight: 500;
  font-size: 15px;
  border-radius: 6px 6px 0 0;
  color: #555;
  transition: all 0.25s ease;
  user-select: none;
  box-shadow: none;
}

.tab-button:hover:not(.active) {
  background-color: #e2e6ef;
  border-color: #a0aec0;
  color: #222;
}

.tab-button.active {
  background: #ffffff;
  border-bottom: 2px solid white;
  border-color: #0073e6;
  font-weight: 600;
  color: #0073e6;
}

.tab-content {
  display: none;
  background: #fff;
  padding: 30px 30px 40px;
  border: 1.5px solid #d1d5db;
  border-radius: 0 8px 8px 8px;
  box-shadow: 0 2px 6px rgb(0 0 0 / 0.06);
}

.tab-content.active {
  display: block;
}

table.dataTable {
  width: 100% !important;
  border-collapse: separate !important;
  border-spacing: 0 8px;
  font-size: 14px;
  box-sizing: border-box;
  margin-bottom: 50px;
  border-radius: 8px;
  overflow-x: auto;
  background-color: #fff;
  border: 1px solid #e2e8f0;
  box-shadow: 0 2px 6px rgb(0 0 0 / 0.05);
}

table.dataTable thead th {
  background-color: #f1f5f9;
  color: #555 !important;
  font-weight: 600 !important;
  padding: 12px 16px !important;
  border-bottom: 2px solid #cbd5e1 !important;
  text-align: left;
  border-radius: 8px 8px 0 0;
}

table.dataTable tbody td {
  padding: 12px 16px !important;
  background-color: #ffffff;
  color: #444;
  border-bottom: 8px solid transparent;
  white-space: nowrap;
  border-radius: 6px;
  transition: background-color 0.3s ease;
}

table.dataTable tbody tr:hover td {
  background-color: #f8fafc;
  color: #222;
}

/* Pagination & controls styling */
.dataTables_wrapper .dataTables_paginate {
  margin-top: 12px;
  text-align: right;
}

.dataTables_wrapper .dataTables_paginate a {
  color: #0073e6 !important;
  font-weight: 500;
  border-radius: 4px;
  padding: 5px 11px;
  border: 1px solid transparent;
  transition: background-color 0.2s ease, border-color 0.2s ease;
  margin-left: 4px;
  user-select: none;
}

.dataTables_wrapper .dataTables_paginate a:hover {
  background-color: #0073e6;
  color: white !important;
  border-color: #005bb5;
}

.dataTables_wrapper .dataTables_paginate .paginate_button.current {
  background-color: #005bb5 !important;
  color: white !important;
  border-color: #005bb5 !important;
}

/* Grid Filter Buttons Container */
#grid-filter-container {
  max-width: 1100px;
  margin: 0 auto 30px auto;
  text-align: center;
  padding: 10px 0;
}

#grid-filter-container button {
  margin: 6px 6px 6px 0;
  padding: 8px 18px;
  font-size: 14px;
  cursor: pointer;
  border: 1.5px solid #b0b7c3;
  border-radius: 5px;
  background-color: #f5f7fa;
  color: #555;
  font-weight: 500;
  user-select: none;
  transition: background-color 0.25s ease, border-color 0.25s ease;
  min-width: 90px;
  white-space: nowrap;
}

#grid-filter-container button:hover {
  background-color: #e0e6f0;
  border-color: #8f9bb9;
  color: #222;
}

#grid-filter-container button.active {
  background-color: #0073e6;
  color: white;
  border-color: #005bb5;
  box-shadow: 0 0 8px rgb(0 115 230 / 0.3);
}

#grid-filter-clear {
  font-weight: 600;
  border-color: #444;
  background-color: #e2e8f0;
  color: #444;
  min-width: 100px;
}

#grid-filter-clear.active {
  background-color: #0073e6;
  color: white;
  border-color: #005bb5;
  box-shadow: 0 0 10px rgb(0 115 230 / 0.4);
}

/* Watermark */
#watermark {
  position: fixed;
  top: 50%;
  left: 50%;
  width: 100vh;
  height: 100vw;
  pointer-events: none;
  user-select: none;
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.05;
  color: #000;
  font-size: 18vw;
  font-weight: 900;
  font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  white-space: nowrap;
  text-align: center;
  transform: translate(-50%, -50%) rotate(68deg);
}

/* Responsive */
@media (max-width: 768px) {
  body {
    padding: 0 15px;
    font-size: 14px;
  }

  h1 {
    font-size: 20px;
    max-width: 100%;
  }

  .tab-button {
    padding: 10px 18px;
    font-size: 14px;
  }

  #grid-filter-container button {
    margin: 5px 6px 5px 0;
    padding: 7px 14px;
    font-size: 13px;
    min-width: auto;
  }
}

.table-wrapper {
  width: 100%;
  overflow-x: auto;
  /* Optional: add some padding or margin */
  margin-bottom: 40px;
  box-shadow: 0 2px 6px rgb(0 0 0 / 0.05);
  border-radius: 8px;
  background: white;
  border: 1px solid #e2e8f0;
}

/* Table styling inside wrapper */
.table-wrapper table.dataTable {
  width: 100% !important;
  border-collapse: separate !important;
  border-spacing: 0 8px;
  font-size: 14px;
  box-sizing: border-box;
  margin: 0;
  border-radius: 8px;
  overflow: visible !important; /* override DataTables overflow */
  /* You can use fixed layout for better alignment */
  table-layout: auto; /* or try fixed */
}

/* Remove display:block and overflow-x:auto from the table */
table.dataTable {
  display: table !important;
  overflow-x: visible !important;
}

  </style>
</head>
<body>

<div id="watermark"></div>

<div id="grid-filter-container">
  <!-- Buttons will be generated here -->
  <button id="grid-filter-clear">Clear</button>
</div>

<script>
  // Function to filter all tables by grid value (regex search)
  function applyGridFilter(value) {
    Object.values(dataTables).forEach(({ dt, gridColIndex }) => {
      if (gridColIndex === -1) return; // skip if no Grid column found
      dt.columns(gridColIndex).search(value, true, false, true).draw();
    });
  }

  const gridIds = [
    "Grid 101", "Grid 105", "Grid 106", "Grid 102", "Grid 104", "Grid 103",
    "Grid 401", "Grid 402", "Grid 403", "Grid 404", "Grid 405",
    "Grid 501", "Grid 502", "Grid 503", "Grid 504", "Grid 505", "Grid 506", "Grid 507", "Grid 508", "Grid 509",
    "Grid 601", "Grid 602", "Grid 603", "Grid 604", "Grid 605"
  ];

  const gridFilterContainer = document.getElementById('grid-filter-container');
  const clearBtn = document.getElementById('grid-filter-clear');

  // Use a Set to track selected grids for easy add/remove and lookup
  const selectedGrids = new Set();

  // Create a button for each gridId and insert before Clear button
  gridIds.forEach(gridId => {
    const btn = document.createElement('button');
    btn.textContent = gridId;

    btn.addEventListener('click', () => {
      if (selectedGrids.has(gridId)) {
        selectedGrids.delete(gridId); // Deselect if already selected
      } else {
        selectedGrids.add(gridId);    // Select if not selected
      }

      updateFilter();
      updateButtonStyles();
    });

    gridFilterContainer.insertBefore(btn, clearBtn);
  });

  // Clear button clears all selections and resets filter
  clearBtn.addEventListener('click', () => {
    selectedGrids.clear();
    updateFilter();
    updateButtonStyles();
  });

  // Update filter to search for any selected grid IDs (regex OR)
  function updateFilter() {
    if (selectedGrids.size === 0) {
      // No filter, show all
      applyGridFilter('');
    } else {
      // Escape special regex chars and join by |
      const regex = Array.from(selectedGrids)
        .map(g => g.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'))
        .join('|');
      applyGridFilter(regex);
    }
  }

  // Update button styles for selected/deselected state
  function updateButtonStyles() {
    const buttons = gridFilterContainer.querySelectorAll('button');
    buttons.forEach(btn => {
      if (btn === clearBtn) {
        btn.classList.toggle('active', selectedGrids.size === 0);
      } else {
        btn.classList.toggle('active', selectedGrids.has(btn.textContent));
      }
    });
  }

  // Initialize with Clear button active and no filter on page load
  updateButtonStyles();
  applyGridFilter('');
</script>

  
<div class="tabs">
  <div class="tab-button active" data-tab="etop">etop</div>
  <div class="tab-button" data-tab="zl">zl</div>
</div>

<div id="etop" class="tab-content active">
  <h1>Grid Level</h1>
  <table id="sheetTable3" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>

  <h1>Franchise Level</h1>
  <table id="sheetTable4" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>
</div>

<div id="zl" class="tab-content">
  <h1>Grid Level</h1>
  <table id="sheetTable7" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>

  <h1>Franchise Level</h1>
  <table id="sheetTable8" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<!-- PapaParse CSV parser -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
  // Tab switching logic
  const tabs = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));

      tab.classList.add('active');
      document.getElementById(tab.dataset.tab).classList.add('active');
    });
  });

  // Sheets config (only Grid and Franchise tables)
  const sheets = [
    {
      url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR2QmehFCp6Isa-ULBnTlNWp_xecKGyvyHo3i1hOXe0Ppfnjbw_hBBOFeoxPYO3mD3NvPrSw7czI70r/pub?gid=206508914&single=true&output=csv",
      tableId: "sheetTable3"
    },
    {
      url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR2QmehFCp6Isa-ULBnTlNWp_xecKGyvyHo3i1hOXe0Ppfnjbw_hBBOFeoxPYO3mD3NvPrSw7czI70r/pub?gid=1057703911&single=true&output=csv",
      tableId: "sheetTable4"
    },
    {
      url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR2QmehFCp6Isa-ULBnTlNWp_xecKGyvyHo3i1hOXe0Ppfnjbw_hBBOFeoxPYO3mD3NvPrSw7czI70r/pub?gid=206508914&single=true&output=csv",
      tableId: "sheetTable7"
    },
    {
      url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR2QmehFCp6Isa-ULBnTlNWp_xecKGyvyHo3i1hOXe0Ppfnjbw_hBBOFeoxPYO3mD3NvPrSw7czI70r/pub?gid=1057703911&single=true&output=csv",
      tableId: "sheetTable8"
    }
  ];

  let dataTables = {}; // Store DataTables instances and related info by tableId

  // Load each sheet CSV, build table and initialize DataTables
  sheets.forEach(({ url, tableId }) => {
    Papa.parse(url, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function (results) {
        const data = results.data;
        if (!data.length) {
          console.warn("No data found for", tableId);
          return;
        }

        const table = document.getElementById(tableId);
        const thead = table.querySelector("thead");
        const tbody = table.querySelector("tbody");

        // Clear old content if any
        thead.innerHTML = "";
        tbody.innerHTML = "";

        // Build headers from keys of first row
        const columns = Object.keys(data[0]);
        const trHead = document.createElement("tr");
        columns.forEach(col => {
          const th = document.createElement("th");
          th.textContent = col;
          trHead.appendChild(th);
        });
        thead.appendChild(trHead);

        // Build body rows
        data.forEach(row => {
          const tr = document.createElement("tr");
          columns.forEach(col => {
            const td = document.createElement("td");
            td.textContent = row[col];
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });

        // Initialize DataTable (with searching disabled globally)
        const dt = $(table).DataTable({
          paging: true,
          searching: true,
          info: true,
          order: [], // no initial ordering
          lengthMenu: [10, 25, 50, 100],
          pageLength: 25,
          autoWidth: false,
          language: {
            paginate: {
              previous: "<",
              next: ">"
            }
          }
        });

        // Find the index of "Grid" column (case insensitive)
        let gridColIndex = columns.findIndex(c => c.trim().toLowerCase() === "grid");

        dataTables[tableId] = { dt, columns, gridColIndex };

        // Display watermark if user is whitelisted
        const whitelist = ["sameenyaser", "naumanzaheer"];
        const currentUsername = localStorage.getItem("username");
        const watermarkDiv = document.getElementById('watermark');
        const repeatCount = 5;

        if (currentUsername && whitelist.includes(currentUsername)) {
          const repeatedText = currentUsername + " ";
          watermarkDiv.innerHTML = Array(repeatCount).fill(`<div>${repeatedText}</div>`).join('');
          watermarkDiv.style.display = 'flex';
        } else {
          watermarkDiv.style.display = 'none';
        }
      }
    });
  });

</script>

</body>
</html>
