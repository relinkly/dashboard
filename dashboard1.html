<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multiple Google Sheets Tables with Tabs</title>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px auto;
      max-width: 1200px;
      background: #f9f9f9;
      font-size: 11px;
      padding: 0 10px;
      box-sizing: border-box;
    }

    h1 {
      text-align: center;
      font-size: 16px;
      margin-top: 40px;
      margin-bottom: 10px;
      color: #333;
    }

    /* Tabs container */
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 20px;
    }

    .tab-button {
      cursor: pointer;
      padding: 10px 20px;
      background: #eee;
      border: 1px solid #ccc;
      border-bottom: none;
      font-weight: bold;
      font-size: 14px;
      border-radius: 5px 5px 0 0;
      user-select: none;
      transition: background-color 0.3s;
    }
    .tab-button.active {
      background: white;
      border-bottom: 2px solid white;
      color: #333;
    }

    /* Tab content containers */
    .tab-content {
      display: none;
      background: white;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 0 5px 5px 5px;
    }
    .tab-content.active {
      display: block;
    }

    table.dataTable {
      width: 100% !important;
      margin-bottom: 40px;
      font-size: 11px;
      box-sizing: border-box;
      overflow-x: auto;
      display: block;
    }

    table.dataTable th,
    table.dataTable td {
      font-size: 11px !important;
      white-space: nowrap;
    }

    /* Container for the Grid ID filter buttons */
    #grid-filter-container {
      max-width: 1200px;
      margin: 0 auto 20px auto;
      text-align: center;
    }
    #grid-filter-container button {
      margin: 3px 5px;
      padding: 6px 12px;
      font-size: 11px;
      cursor: pointer;
      border: 1px solid #888;
      border-radius: 3px;
      background-color: #f0f0f0;
      transition: background-color 0.2s;
    }
    #grid-filter-container button:hover {
      background-color: #ddd;
    }
    #grid-filter-container button.active {
      background-color: #2196F3;
      color: white;
      border-color: #0b7dda;
    }

    #watermark {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 100vh;    /* use viewport height as width since rotated */
      height: 100vw;   /* and viewport width as height */
      pointer-events: none;
      user-select: none;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.1;
      color: #000000;
      font-size: 18vw; /* big text */
      font-weight: 900;
      font-family: Arial, sans-serif;
      white-space: nowrap;
      text-align: center;
      transform: translate(-50%, -50%) rotate(68deg);
    }
  </style>
</head>
<body>

<div id="watermark"></div>

<!-- Grid ID filter buttons at top -->
<div id="grid-filter-container">
  <strong>Filter by Grid ID:</strong><br />
  <button data-gridid="" class="active">Show All</button>
  <button data-gridid="Grid 101">Grid 101</button>
  <button data-gridid="Grid 105">Grid 105</button>
  <button data-gridid="Grid 106">Grid 106</button>
  <button data-gridid="Grid 102">Grid 102</button>
  <button data-gridid="Grid 104">Grid 104</button>
  <button data-gridid="Grid 103">Grid 103</button>
  <button data-gridid="Grid 401">Grid 401</button>
  <button data-gridid="Grid 402">Grid 402</button>
  <button data-gridid="Grid 403">Grid 403</button>
  <button data-gridid="Grid 404">Grid 404</button>
  <button data-gridid="Grid 405">Grid 405</button>
  <button data-gridid="Grid 501">Grid 501</button>
  <button data-gridid="Grid 502">Grid 502</button>
  <button data-gridid="Grid 503">Grid 503</button>
  <button data-gridid="Grid 504">Grid 504</button>
  <button data-gridid="Grid 505">Grid 505</button>
  <button data-gridid="Grid 506">Grid 506</button>
  <button data-gridid="Grid 507">Grid 507</button>
  <button data-gridid="Grid 508">Grid 508</button>
  <button data-gridid="Grid 509">Grid 509</button>
  <button data-gridid="Grid 601">Grid 601</button>
  <button data-gridid="Grid 602">Grid 602</button>
  <button data-gridid="Grid 603">Grid 603</button>
  <button data-gridid="Grid 604">Grid 604</button>
  <button data-gridid="Grid 605">Grid 605</button>
</div>

<div class="tabs">
  <div class="tab-button active" data-tab="etop">etop</div>
  <div class="tab-button" data-tab="zl">zl</div>
</div>

<div id="etop" class="tab-content active">
  <h1>Grid Level</h1>
  <table id="sheetTable3" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>

  <h1>Franchise Level</h1>
  <table id="sheetTable4" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>
</div>

<div id="zl" class="tab-content">
  <h1>Grid Level</h1>
  <table id="sheetTable7" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>

  <h1>Franchise Level</h1>
  <table id="sheetTable8" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<!-- PapaParse CSV parser -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
  // Tab switching logic
  const tabs = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));

      tab.classList.add('active');
      document.getElementById(tab.dataset.tab).classList.add('active');
    });
  });

  // Sheets config (only Grid and Franchise tables)
  const sheets = [
    {
      url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR2QmehFCp6Isa-ULBnTlNWp_xecKGyvyHo3i1hOXe0Ppfnjbw_hBBOFeoxPYO3mD3NvPrSw7czI70r/pub?gid=206508914&single=true&output=csv",
      tableId: "sheetTable3"
    },
    {
      url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR2QmehFCp6Isa-ULBnTlNWp_xecKGyvyHo3i1hOXe0Ppfnjbw_hBBOFeoxPYO3mD3NvPrSw7czI70r/pub?gid=1057703911&single=true&output=csv",
      tableId: "sheetTable4"
    },
    {
      url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR2QmehFCp6Isa-ULBnTlNWp_xecKGyvyHo3i1hOXe0Ppfnjbw_hBBOFeoxPYO3mD3NvPrSw7czI70r/pub?gid=206508914&single=true&output=csv",
      tableId: "sheetTable7"
    },
    {
      url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR2QmehFCp6Isa-ULBnTlNWp_xecKGyvyHo3i1hOXe0Ppfnjbw_hBBOFeoxPYO3mD3NvPrSw7czI70r/pub?gid=1057703911&single=true&output=csv",
      tableId: "sheetTable8"
    }
  ];

  let dataTables = {}; // Store DataTables instances and columns by tableId

  // Load each sheet CSV, build table and initialize DataTables
  sheets.forEach(({ url, tableId }) => {
    Papa.parse(url, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function (results) {
        const data = results.data;
        if (!data.length) {
          console.warn("No data found for", tableId);
          return;
        }

        const table = document.getElementById(tableId);
        const thead = table.querySelector("thead");
        const tbody = table.querySelector("tbody");

        // Clear old content if any
        thead.innerHTML = "";
        tbody.innerHTML = "";

        // Build headers from keys of first row
        const columns = Object.keys(data[0]);
        const trHead = document.createElement("tr");
        columns.forEach(col => {
          const th = document.createElement("th");
          th.textContent = col;
          trHead.appendChild(th);
        });
        thead.appendChild(trHead);

        // Build body rows
        data.forEach(row => {
          const tr = document.createElement("tr");
          columns.forEach(col => {
            const td = document.createElement("td");
            td.textContent = row[col];
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });

        // Initialize DataTable (without built-in search box)
        const dt = $(table).DataTable({
          paging: true,
          searching: false,
          info: true,
          order: [], // no initial ordering
          lengthMenu: [10, 25, 50, 100],
          pageLength: 25,
          autoWidth: false,
          language: {
            paginate: {
              previous: "<",
              next: ">"
            }
          }
        });

        dataTables[tableId] = { dt, columns };

        // Display watermark if user is whitelisted
        const whitelist = ["sameenyaser", "naumanzaheer"];
        const currentUsername = localStorage.getItem("username");
        const watermarkDiv = document.getElementById('watermark');
        const repeatCount = 5;

        if (currentUsername && whitelist.includes(currentUsername)) {
          const repeatedText = currentUsername + " ";
          watermarkDiv.innerHTML = Array(repeatCount).fill(`<div>${repeatedText}</div>`).join('');
          watermarkDiv.style.display = 'flex';
        } else {
          watermarkDiv.style.display = 'none';
        }
      }
    });
  });

  // Global variable for current grid filter
  window.currentGridFilter = "";

  // Set up buttons to filter tables
  document.querySelectorAll("#grid-filter-container button").forEach(btn => {
    btn.addEventListener("click", () => {
      const gridId = btn.getAttribute("data-gridid");
      filterAllTables(gridId);
    });
  });

  // Filter all tables by grid ID
  function filterAllTables(gridId) {
    window.currentGridFilter = gridId;

    // Update active button highlight
    document.querySelectorAll("#grid-filter-container button").forEach(btn => {
      btn.classList.toggle("active", btn.getAttribute("data-gridid") === gridId);
    });

    // Trigger table redraw for filtering
    Object.values(dataTables).forEach(({ dt }) => {
      dt.draw();
    });
  }

  // Custom DataTables filter to filter by Grid column matching currentGridFilter
  $.fn.dataTable.ext.search.push(function (settings, dataRow) {
    const gridIdFilter = (window.currentGridFilter || "").trim();
    if (!gridIdFilter) return true; // no filter, show all

    const tableId = settings.nTable.getAttribute('id');
    if (!tableId || !dataTables[tableId]) return true;

    const { columns } = dataTables[tableId];
    const gridColIndex = columns.indexOf("Grid");
    if (gridColIndex === -1) return true;

    const cellValue = (dataRow[gridColIndex] || "").trim();

    return cellValue === gridIdFilter;
  });
</script>


</body>
</html>
