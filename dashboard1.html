<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multiple Google Sheets Tables with Tabs</title>

  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
      font-size: 13px;
      color: #333;
    }

    h1 {
      text-align: center;
      font-size: 20px;
      color: #222;
      margin-bottom: 20px;
    }

    .tabs {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin: 20px 0;
      gap: 12px;
    }

    .tab-button {
      padding: 10px 20px;
      background: #e0e0e0;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }

    .tab-button.active {
      background: #007BFF;
      color: white;
    }

    .tab-content {
      display: none;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 40px;
    }

    .tab-content.active {
      display: block;
    }

    #grid-filter-container {
      text-align: center;
      margin: 20px auto;
      flex-wrap: wrap;
    }

    #grid-filter-container button {
      margin: 4px 6px;
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #f0f0f0;
      transition: all 0.2s ease;
    }

    #grid-filter-container button:hover {
      background: #ddd;
    }

    #grid-filter-container button.active {
      background: #007BFF;
      color: white;
      border-color: #0056b3;
    }

    table.dataTable {
      width: 100% !important;
      margin-top: 10px;
      font-size: 12px;
      overflow-x: auto;
    }

    table.dataTable th,
    table.dataTable td {
      white-space: nowrap;
    }

    /* Responsive tweaks */
    @media (max-width: 600px) {
      .tab-button {
        flex: 1 1 100%;
        text-align: center;
      }

      #grid-filter-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }

      table.dataTable {
        font-size: 11px;
      }
    }

    #watermark {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      user-select: none;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0.05;
      color: #000;
      font-size: 10vw;
      font-weight: 900;
      text-align: center;
      transform: translate(-50%, -50%);
      overflow: hidden;
    }

    #watermark > div {
      margin: 0.1em 0;
      width: 100%;
      white-space: normal;
    }
  </style>
</head>

<body>

<div id="watermark"></div>

<div id="grid-filter-container">
  <!-- Buttons will be inserted here -->
  <button id="grid-filter-clear">Clear</button>
</div>

<div class="tabs">
  <button class="tab-button active" data-tab="etop">ETOP</button>
  <button class="tab-button" data-tab="zl">ZL</button>
</div>

<div id="etop" class="tab-content active">
  <h1>Grid Level</h1>
  <table id="sheetTable3" class="display">
    <thead></thead>
    <tbody></tbody>
  </table>

  <h1>Franchise Level</h1>
  <table id="sheetTable4" class="display">
    <thead></thead>
    <tbody></tbody>
  </table>
</div>

<div id="zl" class="tab-content">
  <h1>Grid Level</h1>
  <table id="sheetTable7" class="display">
    <thead></thead>
    <tbody></tbody>
  </table>

  <h1>Franchise Level</h1>
  <table id="sheetTable8" class="display">
    <thead></thead>
    <tbody></tbody>
  </table>
</div>

<!-- jQuery & Plugins -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
  // Tab logic
  const tabs = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));

      tab.classList.add('active');
      document.getElementById(tab.dataset.tab).classList.add('active');
    });
  });

  // Grid Filter
  const gridIds = [
    "Grid 101", "Grid 105", "Grid 106", "Grid 102", "Grid 104", "Grid 103",
    "Grid 401", "Grid 402", "Grid 403", "Grid 404", "Grid 405",
    "Grid 501", "Grid 502", "Grid 503", "Grid 504", "Grid 505", "Grid 506", "Grid 507", "Grid 508", "Grid 509",
    "Grid 601", "Grid 602", "Grid 603", "Grid 604", "Grid 605"
  ];

  const gridFilterContainer = document.getElementById('grid-filter-container');
  const clearBtn = document.getElementById('grid-filter-clear');
  const selectedGrids = new Set();

  const dataTables = {};

  function applyGridFilter(value) {
    Object.values(dataTables).forEach(({ dt, gridColIndex }) => {
      if (gridColIndex !== -1) {
        dt.columns(gridColIndex).search(value, true, false, true).draw();
      }
    });
  }

  function updateFilter() {
    if (selectedGrids.size === 0) {
      applyGridFilter('');
    } else {
      const regex = Array.from(selectedGrids)
        .map(g => g.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'))
        .join('|');
      applyGridFilter(regex);
    }
  }

  function updateButtonStyles() {
    const buttons = gridFilterContainer.querySelectorAll('button');
    buttons.forEach(btn => {
      if (btn === clearBtn) {
        btn.classList.toggle('active', selectedGrids.size === 0);
      } else {
        btn.classList.toggle('active', selectedGrids.has(btn.textContent));
      }
    });
  }

  gridIds.forEach(gridId => {
    const btn = document.createElement('button');
    btn.textContent = gridId;
    btn.addEventListener('click', () => {
      selectedGrids.has(gridId) ? selectedGrids.delete(gridId) : selectedGrids.add(gridId);
      updateFilter();
      updateButtonStyles();
    });
    gridFilterContainer.insertBefore(btn, clearBtn);
  });

  clearBtn.addEventListener('click', () => {
    selectedGrids.clear();
    updateFilter();
    updateButtonStyles();
  });

  updateButtonStyles();
  applyGridFilter('');

  const sheets = [
    { url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQoCyl8yMw8VqrSaN5CFhvM5FM4sh4ChwbgFnLWIikcGSinkPaFEhFqH4HUrNKdzuBNia8WRI4lShpa/pub?output=csv", tableId: "sheetTable3" },
    { url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQoCyl8yMw8VqrSaN5CFhvM5FM4sh4ChwbgFnLWIikcGSinkPaFEhFqH4HUrNKdzuBNia8WRI4lShpa/pub?output=csv", tableId: "sheetTable4" },
    { url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQoCyl8yMw8VqrSaN5CFhvM5FM4sh4ChwbgFnLWIikcGSinkPaFEhFqH4HUrNKdzuBNia8WRI4lShpa/pub?output=csv", tableId: "sheetTable7" },
    { url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQoCyl8yMw8VqrSaN5CFhvM5FM4sh4ChwbgFnLWIikcGSinkPaFEhFqH4HUrNKdzuBNia8WRI4lShpa/pub?output=csv", tableId: "sheetTable8" }
  ];

  sheets.forEach(({ url, tableId }) => {
    Papa.parse(url, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function (results) {
        const data = results.data;
        if (!data.length) return;

        const table = document.getElementById(tableId);
        const thead = table.querySelector("thead");
        const tbody = table.querySelector("tbody");

        thead.innerHTML = "";
        tbody.innerHTML = "";

        const columns = Object.keys(data[0]);
        const trHead = document.createElement("tr");
        columns.forEach(col => {
          const th = document.createElement("th");
          th.textContent = col;
          trHead.appendChild(th);
        });
        thead.appendChild(trHead);

        data.forEach(row => {
          const tr = document.createElement("tr");
          columns.forEach(col => {
            const td = document.createElement("td");
            td.textContent = row[col];
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });

        const dt = $(table).DataTable({
          paging: true,
          searching: true,
          info: true,
          order: [],
          lengthMenu: [10, 25, 50, 100],
          pageLength: 25,
          autoWidth: false,
          language: {
            paginate: { previous: "<", next: ">" }
          }
        });

        const gridColIndex = columns.findIndex(c => c.trim().toLowerCase() === "grid");
        dataTables[tableId] = { dt, columns, gridColIndex };

        const whitelist = ["sameenyaser", "naumanzaheer"];
        const currentUsername = localStorage.getItem("username");
        const watermarkDiv = document.getElementById('watermark');
        const repeatCount = 10;

        if (currentUsername && whitelist.includes(currentUsername)) {
          const repeatedText = currentUsername + " ";
          watermarkDiv.innerHTML = Array(repeatCount).fill(`<div>${repeatedText}</div>`).join('');
          watermarkDiv.style.display = 'flex';
        } else {
          watermarkDiv.style.display = 'none';
        }
      }
    });
  });
</script>

</body>
</html>
